# é«˜å“è³ªãªé›»å­ãƒ¬ãƒ³ã‚¸ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ 

ã“ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ã€é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®ãƒ‘ãƒ©ãƒ€ã‚¤ãƒ ã¨ã€é«˜å“è³ªãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢è¨­è¨ˆåŸå‰‡ã‚’å–ã‚Šå…¥ã‚ŒãŸé›»å­ãƒ¬ãƒ³ã‚¸åˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…ã§ã™ã€‚

## ğŸ¯ è¨­è¨ˆã®ç‰¹å¾´

### 1. é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®æ¡ç”¨

#### ç´”ç²‹é–¢æ•°ã®æ´»ç”¨
- **å‰¯ä½œç”¨ãªã—**: ã‚³ã‚¢æ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯ã¯ã™ã¹ã¦ç´”ç²‹é–¢æ•°ã§ã™
- **æ±ºå®šè«–çš„**: åŒã˜å…¥åŠ›ã«å¯¾ã—ã¦å¸¸ã«åŒã˜å‡ºåŠ›ã‚’è¿”ã—ã¾ã™
- **ãƒ†ã‚¹ãƒˆå¯èƒ½æ€§**: å¤–éƒ¨ä¾å­˜ãŒãªã„ãŸã‚ã€å˜ä½“ãƒ†ã‚¹ãƒˆãŒå®¹æ˜“ã§ã™

```c
// ç´”ç²‹ãªçŠ¶æ…‹é·ç§»
MicrowaveStatus apply_event(MicrowaveStatus current, Event event);

// ç´”ç²‹ãªæ™‚é–“è¨ˆç®—
uint32_t calculate_remaining_time(uint32_t current, uint32_t tick_seconds);
```

#### ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ï¼ˆä¸å¤‰ï¼‰ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
- ã™ã¹ã¦ã®ä¸»è¦ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¯ä¸å¤‰ã§ã™
- çŠ¶æ…‹å¤‰æ›´æ™‚ã«æ–°ã—ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã—ã¾ã™
- ãƒ‡ãƒ¼ã‚¿ã®äºˆæ¸¬å¯èƒ½æ€§ã¨å®‰å…¨æ€§ãŒå‘ä¸Šã—ã¾ã™

```c
typedef struct {
    MicrowaveState state;           // èª­ã¿å–ã‚Šå°‚ç”¨
    uint32_t remaining_time;        // èª­ã¿å–ã‚Šå°‚ç”¨
    PowerLevel current_power;       // èª­ã¿å–ã‚Šå°‚ç”¨
} MicrowaveStatus;
```

#### é–¢æ•°åˆæˆãƒ‘ã‚¿ãƒ¼ãƒ³
- è¤‡é›‘ãªå‡¦ç†ã‚’å°ã•ãªç´”ç²‹é–¢æ•°ã®çµ„ã¿åˆã‚ã›ã§å®Ÿç¾
- å†åˆ©ç”¨æ€§ã¨ä¿å®ˆæ€§ãŒå‘ä¸Š

### 2. ä½çµåˆåº¦ãƒ»é«˜å‡é›†åº¦ã®è¨­è¨ˆ

#### ä¾å­˜æ³¨å…¥ï¼ˆDependency Injectionï¼‰
```c
typedef struct {
    DisplayInterface display;       // è¡¨ç¤ºæ©Ÿèƒ½ã‚’æŠ½è±¡åŒ–
    InputInterface input;           // å…¥åŠ›æ©Ÿèƒ½ã‚’æŠ½è±¡åŒ–
    HardwareInterface hardware;     // ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚’æŠ½è±¡åŒ–
    TimerInterface timer;           // ã‚¿ã‚¤ãƒãƒ¼ã‚’æŠ½è±¡åŒ–
} IOContext;
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ é–“ã®ç§»æ¤ãŒç°¡å˜
- ãƒ†ã‚¹ãƒˆãŒå®¹æ˜“ï¼ˆãƒ¢ãƒƒã‚¯å®Ÿè£…ã¨ã®ç½®æ›ï¼‰
- è²¬å‹™ãŒæ˜ç¢ºã«åˆ†é›¢ã•ã‚Œã‚‹

#### ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ†é›¢
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Application Layer              â”‚ (main.c, application.c)
â”‚   ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ã€UIåˆ¶å¾¡              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      Domain Layer (Core)            â”‚ (core.c)
â”‚   ç´”ç²‹ãªæ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      I/O Abstraction Layer          â”‚ (io.c)
â”‚   ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ä¾å­˜å‡¦ç†          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. ä¿å®ˆæ€§ã®å‘ä¸Š

#### æ˜ç¢ºãªè²¬å‹™åˆ†é›¢
- **types.h**: ãƒ‡ãƒ¼ã‚¿å‹å®šç¾©ã®ã¿
- **core.h/c**: ç´”ç²‹ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
- **io.h/c**: ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢æŠ½è±¡åŒ–
- **application.h/c**: çµ±åˆãƒ»ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

#### çµåˆåº¦ã®ä½ã•
- core.cã¯io.cã‚’çŸ¥ã‚‰ãªã„
- io.cã¯application.cã‚’çŸ¥ã‚‰ãªã„
- å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ç‹¬ç«‹ã—ã¦å¤‰æ›´å¯èƒ½

#### å¤‰æ›´ã¸ã®å¼·ã•
```
å¤‰æ›´ä¾‹1: è¡¨ç¤ºæ–¹å¼ã‚’å¤‰æ›´ï¼ˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«â†’LCDï¼‰
â†’ io.c ã® DisplayInterface å®Ÿè£…ã‚’å¤‰æ›´ã™ã‚‹ã®ã¿

å¤‰æ›´ä¾‹2: çŠ¶æ…‹é·ç§»ãƒ­ã‚¸ãƒƒã‚¯ã‚’å¤‰æ›´
â†’ core.c ã® apply_event() ã‚’å¤‰æ›´ã™ã‚‹ã®ã¿

å¤‰æ›´ä¾‹3: æ–°ã—ã„ã‚¤ãƒ™ãƒ³ãƒˆå‹ã‚’è¿½åŠ 
â†’ types.h ã« EventType ã‚’è¿½åŠ ã€apply_event() ã‚’æ‹¡å¼µ
```

### 4. å†åˆ©ç”¨æ€§

#### ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®æ±ç”¨æ€§
```c
// ä»»æ„ã®è¡¨ç¤ºãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«å¯¾å¿œå¯èƒ½
DisplayInterface lcd_display = create_lcd_display();
DisplayInterface web_display = create_web_display();
DisplayInterface mqtt_display = create_mqtt_display();

// ã‚³ã‚¢æ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯ã¯å¤‰ã‚ã‚‰ãªã„
```

#### ãƒ†ã‚¹ãƒˆç”¨ã®å®Ÿè£…
```c
// æœ¬ç•ªç’°å¢ƒ
IOContext prod_io = create_io_context();

// ãƒ†ã‚¹ãƒˆç’°å¢ƒ
IOContext test_io = {
    .display = create_test_display(),
    .input = create_test_input(),
    .hardware = create_mock_hardware(),
    .timer = create_mock_timer(),
};
```

### 5. ç§»æ¤æ€§

#### ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ éä¾å­˜ã®ã‚³ã‚¢
- core.c ã«ã¯ platform.h ã®ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ãªã—
- io.c ã§å…¨ã¦ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ä¾å­˜ã‚’å‡¦ç†

```c
#ifdef _WIN32
    // Windowså›ºæœ‰
#else
    // Unix/Linuxå›ºæœ‰
#endif
```

#### ç°¡å˜ãªãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ è¿½åŠ 
æ–°ã—ã„ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å¯¾å¿œã¯ io.c ã®ã¿:
- `create_console_display()`
- `create_console_input()`
- `create_mock_hardware()`
- `create_system_timer()`

ã‚’å®Ÿè£…ã™ã‚‹ã ã‘

## ğŸ“Š ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®åˆ©ç‚¹

| è¦³ç‚¹ | å¾“æ¥å‹ | æœ¬å®Ÿè£… |
|------|------|--------|
| çµåˆåº¦ | é«˜ï¼ˆãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ä¾å­˜ï¼‰ | ä½ï¼ˆæŠ½è±¡åŒ–å±¤ï¼‰ |
| å‡é›†åº¦ | ä½ï¼ˆè¤‡æ•°ã®è²¬å‹™æ··åœ¨ï¼‰ | é«˜ï¼ˆè²¬å‹™æ˜ç¢ºï¼‰ |
| ãƒ†ã‚¹ãƒˆ | å›°é›£ï¼ˆå¤–éƒ¨ä¾å­˜ï¼‰ | å®¹æ˜“ï¼ˆç´”ç²‹é–¢æ•°ï¼‰ |
| ç§»æ¤æ€§ | å›°é›£ | å®¹æ˜“ |
| æ‹¡å¼µæ€§ | å›°é›£ï¼ˆæ—¢å­˜ã‚³ãƒ¼ãƒ‰å¤‰æ›´ï¼‰ | å®¹æ˜“ï¼ˆæ–°å®Ÿè£…è¿½åŠ ï¼‰ |

## ğŸ”„ é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

### 1. State Monad ãƒ‘ã‚¿ãƒ¼ãƒ³
```c
// çŠ¶æ…‹ã‚’å…¥åŠ›ã¨ã—ã¦ã€æ–°ã—ã„çŠ¶æ…‹ã‚’å‡ºåŠ›
MicrowaveStatus apply_event(MicrowaveStatus current, Event event);

// é€£é–å¯èƒ½ï¼ˆãƒ¢ãƒŠãƒ‰çš„ï¼‰
MicrowaveStatus s1 = apply_event(initial, event1);
MicrowaveStatus s2 = apply_event(s1, event2);
MicrowaveStatus s3 = apply_event(s2, event3);
```

### 2. Result å‹ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼‰
```c
typedef struct {
    bool success;
    int error_code;
    const char* error_message;
} Result;

// Rustã® Result<T, E> ã‚’æ¨¡å€£
Result validate_cooking_config(CookingConfig config);
```

### 3. ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å‡¦ç†
```c
// ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ› â†’ ã‚¤ãƒ™ãƒ³ãƒˆå¤‰æ› â†’ çŠ¶æ…‹é·ç§» â†’ UIæ›´æ–° â†’ ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢åæ˜ 
```

### 4. é«˜éšé–¢æ•°ï¼ˆé–¢æ•°ãƒã‚¤ãƒ³ã‚¿ï¼‰
```c
typedef Result (*StateTransition)(MicrowaveStatus current, Event event);
```

## ğŸ”§ ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã¨å®Ÿè¡Œ

### CMake ã§ãƒ“ãƒ«ãƒ‰
```bash
mkdir build
cd build
cmake ..
make
./microwave
```

### ç›´æ¥ãƒ“ãƒ«ãƒ‰
```bash
gcc -o microwave main.c core.c io.c application.c -std=c99 -Wall -Wextra
./microwave
```

## ğŸ® æ“ä½œæ–¹æ³•

| ã‚­ãƒ¼ | æ©Ÿèƒ½ |
|------|------|
| s | èª¿ç†é–‹å§‹ |
| p | ä¸€æ™‚åœæ­¢ |
| r | å†é–‹ |
| c | ã‚­ãƒ£ãƒ³ã‚»ãƒ« |
| t | èª¿ç†æ™‚é–“å¤‰æ›´ï¼ˆå¾ªç’°ï¼‰ |
| w | å‡ºåŠ›å¤‰æ›´ï¼ˆå¾ªç’°ï¼‰ |
| q | çµ‚äº† |

## ğŸ“ ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆç´”ç²‹é–¢æ•°ï¼‰
```c
void test_apply_event() {
    MicrowaveStatus initial = create_initial_state();
    Event start_event = {.type = EVENT_START_COOKING};
    
    MicrowaveStatus result = apply_event(initial, start_event);
    
    assert(result.state == STATE_COOKING);
    assert(result.magnetron_state == MAGNETRON_ON);
}
```

### ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ
```c
void test_cooking_cycle() {
    MicrowaveApp app = app_create();
    
    // ã‚¯ãƒƒã‚­ãƒ³ã‚°é–‹å§‹ã‚¤ãƒ™ãƒ³ãƒˆ
    Event start = {.type = EVENT_START_COOKING};
    apply_state_transition(&app, start);
    
    // ã‚¿ã‚¤ãƒãƒ¼ãƒ†ã‚£ãƒƒã‚¯è¤‡æ•°å›
    for (int i = 0; i < 10; i++) {
        Event tick = {.type = EVENT_TIMER_TICK};
        apply_state_transition(&app, tick);
    }
    
    // çŠ¶æ…‹ç¢ºèª
    assert(app.current_state.remaining_time == 0 ||
           app.current_state.state == STATE_COMPLETED);
}
```

## ğŸš€ æ‹¡å¼µã®ã—ã‚„ã™ã•

### æ–°æ©Ÿèƒ½è¿½åŠ ä¾‹ï¼šè‡ªå‹•èª¿ç†ãƒ¢ãƒ¼ãƒ‰

```c
// types.h ã«è¿½åŠ 
typedef enum {
    COOKING_MODE_MANUAL,
    COOKING_MODE_AUTO,
    COOKING_MODE_DEFROST,
} CookingMode;

// core.c ã«è¿½åŠ 
MagnetronCycle get_auto_magnetron_cycle(FoodType type) {
    // è‡ªå‹•ã§æœ€é©ãªã‚µã‚¤ã‚¯ãƒ«ã‚’è¨ˆç®—
}

// æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ã¯å¤‰æ›´ä¸è¦
```

### æ–°ã—ã„è¡¨ç¤ºãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è¿½åŠ ä¾‹

```c
// io.c ã«è¿½åŠ 
DisplayInterface create_lcd_display(void) {
    return (DisplayInterface){
        .clear_screen = lcd_clear_screen,
        .print_line = lcd_print_line,
        .print_status = lcd_print_status,
    };
}

// main.c ã¯å¤‰æ›´ä¸è¦
```

## ğŸ“š è¨­è¨ˆåŸå‰‡ã®éµå®ˆ

### SOLID åŸå‰‡
- **S** (Single Responsibility): å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒå˜ä¸€ã®è²¬å‹™
- **O** (Open/Closed): æ‹¡å¼µã«é–‹ã‹ã‚Œã€å¤‰æ›´ã«é–‰ã˜ã‚‰ã‚Œã¦ã„ã‚‹
- **L** (Liskov Substitution): ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ç½®æ›å¯èƒ½æ€§
- **I** (Interface Segregation): ç´°ç²’åº¦ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- **D** (Dependency Inversion): æŠ½è±¡ã«ä¾å­˜ã€å…·ä½“ã«ä¾å­˜ã—ãªã„

### DRY åŸå‰‡ (Don't Repeat Yourself)
- çŠ¶æ…‹é·ç§»ãƒ­ã‚¸ãƒƒã‚¯ã¯ apply_event() ã«é›†ç´„
- è¡¨ç¤ºå¤‰æ›ã¯ status_to_display() ã«é›†ç´„

### YAGNI åŸå‰‡ (You Aren't Gonna Need It)
- å¿…è¦ãªæ©Ÿèƒ½ã®ã¿ã‚’å®Ÿè£…
- å°†æ¥ã®æ‹¡å¼µã‚’è¦‹è¶Šã—ãŸéåº¦ãªæ±ç”¨åŒ–ã‚’é¿ã‘ã‚‹

## ğŸ“ å­¦ç¿’ä¾¡å€¤

ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã‚’å­¦ã¶ã®ã«é©ã—ã¦ã„ã¾ã™ï¼š

1. **é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°**: ç´”ç²‹é–¢æ•°ã€ä¸å¤‰æ€§ã€é–¢æ•°åˆæˆ
2. **ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³**: ä¾å­˜æ³¨å…¥ã€ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã€ãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³
3. **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰è¨­è¨ˆã€é–¢å¿ƒã®åˆ†é›¢ã€DDDçš„æ€æƒ³
4. **Cã®é«˜åº¦ãªä½¿ç”¨æ³•**: é–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã€æ§‹é€ ä½“ã€ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ“ãƒªãƒ†ã‚£
5. **ãƒ†ã‚¹ãƒˆé§†å‹•è¨­è¨ˆ**: ãƒ†ã‚¹ãƒˆå¯èƒ½æ€§ã‚’é‡è¦–ã—ãŸè¨­è¨ˆ

## ğŸ“Œ ã¾ã¨ã‚

ã“ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ï¼š
- âœ… **ä¿å®ˆæ€§**: æ˜ç¢ºãªãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ†é›¢ã¨å˜ä¸€è²¬å‹™
- âœ… **ç§»æ¤æ€§**: ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ä¾å­˜éƒ¨åˆ†ã‚’å®Œå…¨ã«éš”é›¢
- âœ… **å†åˆ©ç”¨æ€§**: ç´”ç²‹é–¢æ•°ã¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹æŠ½è±¡åŒ–
- âœ… **é«˜å‡é›†åº¦**: é–¢é€£ã™ã‚‹æ©Ÿèƒ½ã‚’ã¾ã¨ã‚ã¦ã„ã‚‹
- âœ… **ä½çµåˆåº¦**: å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“ã®ä¾å­˜ãŒæœ€å°

ã‚’å®Ÿç¾ã™ã‚‹ã€ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³å“è³ªã®ã‚³ãƒ¼ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚
