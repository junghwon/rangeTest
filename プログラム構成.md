# プログラム構成

## クラス図
    range_class_diagram.pdfを参照。
<br>

## MVCモデル
    本プログラムはMVCモデルパターンに沿って作成されている。
    電子レンジ動作のロジックを担当するModel、
    表示に関する処理を担当するView、
    ユーザー入力及び、ModelとViewに対する制御を担当するControllerから成る。

    以下に各クラスとM、V、Cそれぞれの対応を記載する。
    ・Model：rangeCookModel, rangeMagnetronModel, rangeRelayModel, rangeTimerModel
    ・View：rangeView
    ・Controller：rangeController, rangeKeyController
<br>

## 各クラスの役割
### rangeController
    主にユーザーから見える設定、操作を行う。
    属性
    ・watt          …　電子レンジ出力設定値
    ・timer         …　調理時間設定値
    操作
    ・startup       …　起動処理を行う。
    ・wattSetting   …　電子レンジの出力を設定する。
    ・timerSetting  …　調理時間を設定する。
    ・start         …　調理を開始する。
    ・stop          …　調理完了時の処理。
    ・manager       …　調理工程制御(rangeCookModel)を呼び出す。

### rangeKeyController
    キーボード入力を制御する。
    属性
    ・keyCode       …　入力されたキーコードの値
    操作
    ・scanKey      …　キーボードの入力監視を行う。
    ・getKey       …　キーコードを取得する。

### rangeView
    表示の制御を行う。
    属性
    ・なし
    操作
    ・startUpDisplay    …　起動時の表示を行う。
    ・wattDisplay       …　出力設定時の表示を行う。
    ・timerDisplay      …　調理時間設定時の表示を行う。
    ・startDisplay      …　調理開始時の表示を行う。
    ・stopDisplay       …　調理完了時の表示を行う。
    ・cookTimerDisplay  …　調理中のカウントダウン表示を行う。

### rangeCookModel
    調理工程を制御する。
    属性
    ・state             …　調理工程
    ・cookTimer         …　調理時間（カウント値）
    操作
    ・cookManager       …　調理工程を制御する。以下の状態を持つ。
                                stateStandby：調理スタンバイ
                                stateCook：調理中
                                stateEnd：調理完了
    ・cookStart         …　調理工程を開始する。
    ・getCookTimer      …　調理時間を取得する。

### rangeMagnetronModel
    マグネトロンの駆動を制御する。
    属性
    ・mqOnTime      …　マグネトロンON時間設定値
    ・mqOffTime     …　マグネトロンOFF時間設定値
    ・state         …　マグネトロンON又は、OFFの状態
    ・mqCounter     …　マグネトロンON又は、OFFのカウント値
    操作
    ・manager       …　マグネトロンON、OFF状態を制御する。
    ・init          …　マグネトロン駆動状態を初期化する。
    ・mqStart       …　マグネトロンの駆動時間を設定し、駆動制御を開始する。

### rangeRelayModel
    リレー制御を行う。
    属性
    ・relayState    …　リレーのON、OFF状態
    操作
    ・relayOn       …　リレー状態をONにする。
    ・relayOff      …　リレー状態をOFFにする。

### rangeTimerModel
    制御に関する時間のカウントを行う。
    属性
    ・timer         …　カウント値のアドレス
    ・countEnable   …　カウント許可
    操作
    ・setTimer      …　カウント値に時間をセットする。
    ・initTimer     …　カウント値を初期化する。
    ・countTimer    …　カウントを行う。
<br>

## クラスの実装方法
### クラスの定義
    クラスは構造体（struct）を用いて定義する。
    クラスは以下の3種類のメンバーを持つことができる。
    ・属性（フィールド）：クラスが所有する変数
    ・操作（メソッド）  ：クラスが所有する関数
    ・集約              ：他クラスを集約することができる

### メソッドの定義
    メソッドはまず関数ポインタを宣言し、そのポインタ変数をクラスに格納する。
    自身が格納されるクラスのポインタをメソッドの第一引数に指定する。

### クラスとメソッド宣言の例
```c
// まずはクラス型をtypedef宣言する
typedef _sampleClass sampleClass_t;

// メソッドを宣言する
void (*method)(sampleClass_t *this, int a);

// クラスを定義する
struct _sampleClass {
    // 属性
    int field;
    // 操作
    method pMethod;
    // 集約
    anotherClass_t anotherClass;
};
```

### クラスの初期化
    以下の様に、まずはメソッドの実体を宣言＆定義する。
    次にクラスの初期値を変数として定義し、属性と操作をコンストラクタ関数で初期化する。
```c
// メソッドの実体を宣言
static void method (sampleClass_t *this, int a);

// クラスの初期値を定義
const sampleClass_t sampleClassInitValue = {
    0,
    &method
};

// メソッドの実体を定義
static void method (sampleClass_t *this, int a)
{
    printf ("field = %d\n", this->field);
}

// コンストラクタで初期化
void sampleClass_Constructor (sampleClass_t *this)
{
    this->field = sampleClassInitValue.field;
    this->pMethod = sampleClassInitValue.pMethod;
}
```
### インスタンスの生成と初期化
    以下のようにインスタンスを生成し、コンストラクタを呼び出して初期化する。
```c
sampleClass_t sampleClass;                  // 生成
sampleClass_Constructor (&sampleClass);     // 初期化
```

### メソッドの呼び出し
    別クラスなどから、以下のようにして呼び出す。
```c
sampleClass->method (&sampleClass, 1);
```

